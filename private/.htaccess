Options +Indexes

RewriteEngine on
RewriteBase /victory/private

# Use this line only if a script cares about the identity of the client:
#SSLOptions +OptRenegotiate +StdEnvVars
# Otherwise, comment out the previous line and uncomment the following line:
SSLOptions +OptRenegotiate
#SSLVerifyClient require
#SSLVerifyDepth 3
#SSLRequire %{SSL_CLIENT_S_DN_O} == "MIT Computer Science & Artificial Intelligence Laboratory"

RewriteCond          %{HTTPS} !=on
RewriteRule          (.*) https://people.csail.mit.edu/victory/private/$1

<If "%{HTTPS} == 'on'">

# This sets the default state of the directory to be "closed".
Require all denied

# Apache 2.4 Require directives are OR-ed together by default.
# We need AND behavior here.
<RequireAll>
    # Tell OIDC module to deny unauthenticated users
    Require valid-user
    # Disallow any access on unencrypted sessions (fallback)
    Require ssl
    # Require usue of CSAIL OIDC provider
    Require claim iss:https://oidc.csail.mit.edu/
</RequireAll>

# Enable OIDC processing on this directory (but doesn't require it).
AuthType openid-connect

</If>
